<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Music Player</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #1a1a1a, #0f1c2f, #2c1a36);
    }

    .container {
      width: 360px;
      z-index: 2;
      position: relative;
      text-align: center;
      color: white;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .button {
      background: #ffffff20;
      border: none;
      padding: 0.6rem 1.2rem;
      color: white;
      font-size: 0.9rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .button:hover {
      background: #ffffff40;
    }

    #startOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 10;
    }

    .visualizer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 150px;
      display: flex;
      align-items: flex-end;
      padding: 0 2px;
      z-index: 1;
    }

    .bar {
      flex: 1;
      margin: 0 1px;
      border-radius: 2px;
      background: #00ffff; /* Cyan */
      transition: height 0.1s ease-out;
    }

    iframe {
      margin-top: 1.5rem;
      border-radius: 12px;
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">

const AudioVisualizer = ({ audio }) => {
  const containerRef = React.useRef(null);

  React.useEffect(() => {
    if (!audio) return;

    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const analyser = ctx.createAnalyser();
    const source = ctx.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(ctx.destination);
    analyser.fftSize = 256;

    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    const container = containerRef.current;
    container.innerHTML = "";

    const bars = [];
    for (let i = 0; i < bufferLength; i++) {
      const bar = document.createElement("div");
      bar.className = "bar";
      container.appendChild(bar);
      bars.push(bar);
    }

    let animationId;

    function animate() {
      animationId = requestAnimationFrame(animate);
      analyser.getByteFrequencyData(dataArray);
      bars.forEach((bar, i) => {
        const value = dataArray[i];
        const height = (value / 255) * 100; // smoother scaling
        bar.style.height = `${height}%`;
      });
    }

    animate();

    return () => {
      cancelAnimationFrame(animationId);
      ctx.close();
    };
  }, [audio]);

  return <div className="visualizer" ref={containerRef}></div>;
};

const App = () => {
  const [started, setStarted] = React.useState(false);
  const [isPlaying, setIsPlaying] = React.useState(false);
  const [audio, setAudio] = React.useState(null);

  const start = () => {
    const a = new Audio("/music/music.mp3"); // Your local file
    a.loop = true;
    a.volume = 0.8;
    a.play();
    setAudio(a);
    setIsPlaying(true);
    setStarted(true);
  };

  const togglePlay = () => {
    if (!audio) return;
    if (isPlaying) {
      audio.pause();
    } else {
      audio.play();
    }
    setIsPlaying(!isPlaying);
  };

  return (
    <>
      {!started && <div id="startOverlay" onClick={start}>Click Anywhere to Start Music Player</div>}

      {started && (
        <div className="container">
          <h1>Now Playing</h1>
          <div>ðŸŽµ music.mp3</div>
          <div className="controls">
            <button className="button" onClick={togglePlay}>
              {isPlaying ? "Pause" : "Play"}
            </button>
          </div>

          {/* Spotify Playlist Embed */}
          <iframe
            src="https://open.spotify.com/embed/playlist/34FCT6n4pi2VrfmpoS6SgF?utm_source=generator&theme=0"
            width="100%"
            height="380"
            frameBorder="0"
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
            loading="lazy"
          ></iframe>
        </div>
      )}

      {started && audio && <AudioVisualizer audio={audio} />}
    </>
  );
};

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
